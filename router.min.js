'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function f(g,h){try{var j=b[g](h),k=j.value}catch(l){return void d(l)}return j.done?void c(k):Promise.resolve(k).then(function(l){f('next',l)},function(l){f('throw',l)})}return f('next')})}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}window.STRouter=function(){var a=function(){function b(){var c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;_classCallCheck(this,b),this.routes=c,this.defaulRoute=this.getDefaulRoute,this.links=[],this.componentNames=new Set,this.__setGlobalAliases__(),this._detectMountPlace_(),this.addListener({target:document,type:'click',listener:this.__clickWatching__.bind(this),name:'_routerClickWatcher'}),this.addListener({target:window,type:'popstate',listener:this.render.bind(this),name:'_routerHistoryWatcher'})}return b.prototype.__setGlobalAliases__=function __setGlobalAliases__(){window.$routes=this.routes,window.$location=this.getLocation},b.prototype.__comparePaths__=function __comparePaths__(){var f,c='',d=this.getLocation.path.split('/');return 2<d.length&&''==d[d.length-1]&&d.pop(),this.routes.forEach(function(g){var h=[];c=g.path.split('/'),c.length==d.length&&(c.forEach(function(j,k){-1==j.indexOf(':')&&j===d[k]?h.push(1):-1==j.indexOf(':')&&j!==d[k]&&''==d[k]?h.push(0):-1<j.indexOf(':')?h.push(1):h.push(0)}),!h.some(function(j){return 0==j})&&(f=g))}),f},b.prototype.__typeOfComponent__=function __typeOfComponent__(c){switch('undefined'==typeof c?'undefined':_typeof(c)){case'function':return c();case'object':return c;}},b.prototype.__cleanListeners=function __cleanListeners(){var c=this;if(Object.keys(this.listeners).forEach(function(d){0==c.listeners[d].length&&delete c.listeners[d]}),0==Object.keys(this.listeners).length)return void delete this.listeners},b.prototype.__runChildrenBeforeMount=function __runChildrenBeforeMount(c){var g=this,d=[],f=function(h){Object.keys(h.children).forEach(function(j){var k=g.__typeOfComponent__(h.children[j]);'beforeMount'in k&&d.push(k.beforeMount()),'children'in k&&f(k)})};return f(c),d.filter(function(h){return void 0!==h})},b.prototype.__clickWatching__=function __clickWatching__(c){if(!c.target.hasAttribute('download'))if('A'!==c.target.tagName){for(var d=c.target.parentNode;'A'!==d.tagName;)if(d=d.parentNode,null==d||!d.tagName)return;'A'==d.tagName&&RegExp(location.origin).test(d.href)&&(c.preventDefault(),this.links.push(d.href),history.pushState('','',d.href),this.render())}else RegExp(location.origin).test(c.target.href)&&(c.preventDefault(),this.links.push(c.target.href),history.pushState('','',c.target.href),this.render())},b.prototype._detectMountPlace_=function _detectMountPlace_(){if(0==document.getElementsByTagName('router-view').length){var c=new Error('STR-Warn: \u041D\u0435 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u044B \u0442\u043E\u0447\u043A\u0438 \u043C\u043E\u043D\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F. Missing "<router-view>" tag.');console.warn(c.message)}},b.prototype._setMountPlace_=function _setMountPlace_(){var c=document.getElementsByTagName('router-view');if(0!=c.length){for(var d=0;d<c.length;d++){this.componentNames.add(c[d].getAttribute('name'));var f=document.createElement('div');f.setAttribute('name','component-'+c[d].getAttribute('name')),c[d].insertAdjacentElement('beforebegin',f)}var g=function(){for(var h=0;h<document.getElementsByTagName('router-view').length;h++)document.getElementsByTagName('router-view')[h].remove();0<document.getElementsByTagName('router-view').length&&g()};g()}},b.prototype._clearMountPlace_=function _clearMountPlace_(){this.componentNames.forEach(function(c){document.getElementsByName('component-'+c).forEach(function(d){return d.innerHTML=''})})},b.prototype._renderChildComponent_=function _renderChildComponent_(c){var f=this,d=c.template;return Promise.resolve().then(function(){var g=function(j){if('children'in j){var k=Object.keys(j.children);k.forEach(function(l){var m='<router.*?s*name[^w]*'+l+'[^w]*></[^w]*router.*?>',n=f.__typeOfComponent__(j.children[l]),o=n.template;if('methods'in n&&(o=f._runMethods_(n)),RegExp(m,'g').test(d)){for(var q,p=RegExp(m,'g'),r=[];null!==(q=p.exec(d));)r=r.concat(q);r.forEach(function(s){return d=d.replace(RegExp(s),o)})}'mounted'in n&&n.mounted(),'children'in n&&g(n)})}},h=function(){var j=_asyncToGenerator(regeneratorRuntime.mark(function k(){return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,Promise.all(f.__runChildrenBeforeMount(c));case 2:return g(c),m.abrupt('return',d);case 4:case'end':return m.stop();}},k,f)}));return function(){return j.apply(this,arguments)}}();return h()})},b.prototype._runMethods_=function _runMethods_(c,d){for(var k,f=/[^{]+(?=}})/ig,g=d||c.template,h=c.methods,j=[];null!==(k=f.exec(g));)j=j.concat(k);return j.forEach(function(l){l&&h[l]&&(g=g.replace(RegExp('{{'+l+'}}'),h[l]()))}),g},b.prototype._setActiveLinks_=function _setActiveLinks_(){var c=document.getElementsByTagName('a');setTimeout(function(){Object.keys(c).forEach(function(d){document.getElementsByTagName('a')[d].href==location.href?document.getElementsByTagName('a')[d].classList.add('router-link-active'):document.getElementsByTagName('a')[d].classList.remove('router-link-active')})},100)},b.prototype.getRouteComponents=function getRouteComponents(){if(this.routes){var c=this.__comparePaths__();return c?c:this.defaulRoute}var d=new Error('STR-Warn: \u041D\u0435 \u0437\u0430\u0434\u0430\u043D\u044B \u043C\u0430\u0440\u0448\u0440\u0443\u0442\u044B. Routes are not defined.');console.warn(d.message)},b.prototype.addListener=function addListener(_ref2){var c=_ref2.target,d=_ref2.type,f=_ref2.listener,g=_ref2.options,h=_ref2.name,j=_ref2.once;4>Object.keys(arguments[0]).length||(!('listeners'in this)&&(this.listeners={}),!(d in this.listeners)&&(this.listeners[d]=[]),this.listeners[d].push({target:c,type:d,listener:f,options:g?g:void 0,name:h,once:j||!1}),c.addEventListener(d,f,g?g:void 0))},b.prototype.removeListeners=function removeListeners(c){var d=this;if(this.__cleanListeners(),!!this.listeners){if(0==arguments.length)return void Object.keys(this.listeners).forEach(function(g){d.listeners[g].forEach(function(h){!0==h.once&&h.target.removeEventListener(h.type,h.listener,h.options)}),d.listeners[g]=d.listeners[g].filter(function(h){return!1==h.once})});if(1==arguments.length){if('string'==typeof c)return Object.keys(this.listeners).forEach(function(g){d.listeners[g].forEach(function(h){h.name==c&&h.target.removeEventListener(h.type,h.listener,h.options)}),d.listeners[g]=d.listeners[g].filter(function(h){return h.name!==c})}),void this.__cleanListeners();if('object'==('undefined'==typeof c?'undefined':_typeof(c))){Object.keys(c).length;if('name'in c)return Object.keys(this.listeners).forEach(function(g){d.listeners[g].forEach(function(h){h.name==c.name&&h.target.removeEventListener(h.type,h.listener,h.options)}),d.listeners[g]=d.listeners[g].filter(function(h){return h.name!==c})}),void this.__cleanListeners();if('target'in c&&1==Object.keys(c).length)return Object.keys(this.listeners).forEach(function(g){d.listeners[g].forEach(function(h){h.target==target&&target.removeEventListener(h.type,h.listener,h.options)}),d.listeners[g]=d.listeners[g].filter(function(h){return h.target!==target})}),void this.__cleanListeners();if('type'in c&&1==Object.keys(c).length&&c.type in this.listeners)return this.listeners[c.type].forEach(function(g){return g.target.removeEventListener(c.type,g.listener,g.options)}),delete this.listeners[c.type],void this.__cleanListeners()}}else console.log('STRouter.removeListeners \u0432\u044B\u0431\u0440\u043E\u0441\u0438\u043B \u0438\u0441\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435')}},b.prototype.render=function render(){var d=this;this._setMountPlace_();var c=this.getRouteComponents();c&&(this._clearMountPlace_(),this.removeListeners(),this.componentNames.forEach(function(f){if(f in c.components){var g=function(k){var l=function(m,n){n=n||m.template,'methods'in m&&(n=d._runMethods_(m,n)),document.getElementsByName('component-'+f).forEach(function(o){return o.insertAdjacentHTML('beforeend',n)}),'mounted'in m&&m.mounted(),scrollTo(0,0)};'children'in k?d._renderChildComponent_(k).then(function(m){return l(k,m)}):l(k)},h=d.__typeOfComponent__(c.components[f]);if('beforeMount'in h){var j=h.beforeMount();j&&'[object Promise]'==j.toString()?j.then(function(){return g(h)}):g(h)}else g(h)}}),this._setActiveLinks_())},_createClass(b,[{key:'version',get:function get(){return'1.0.2'}},{key:'getLocation',get:function get(){return{hash:location.hash,href:location.href,origin:location.origin,path:location.pathname,search:location.search}}},{key:'getDefaulRoute',get:function get(){var c;if(this.routes&&(c=this.routes.find(function(f){return'*'==f.path})),!c){var d=new Error('STR-Warn: \u041D\u0435 \u0437\u0430\u0434\u0430\u043D \u043C\u0430\u0440\u0448\u0440\u0443\u0442 \u043F\u043E-\u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E. Default route is not defined.');console.warn(d.message)}return c}}]),b}();return a.version=a.prototype.version,a.getLocation=a.prototype.getLocation,a}();
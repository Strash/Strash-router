'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}window.STRouter=function(){var a=function(){function b(){var c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;_classCallCheck(this,b),this.routes=c,this.defaulRoute=this.getDefaulRoute,this.links=[],this.componentNames=new Set,this.__setGlobalAliases__(),this.addListener({target:document,type:'click',listener:this.__clickWatching__.bind(this),name:'_routerClickWatcher'}),this.addListener({target:window,type:'popstate',listener:this.render.bind(this),name:'_routerHistoryWatcher'})}return _createClass(b,[{key:'__setGlobalAliases__',value:function __setGlobalAliases__(){window.$routes=this.routes,window.$location=this.getLocation}},{key:'__typeOfRouteComponents__',value:function __typeOfRouteComponents__(c,d){switch(_typeof(c.components[d])){case'function':return c.components[d]();case'object':return c.components[d];}}},{key:'__typeOfComponent__',value:function __typeOfComponent__(c){switch('undefined'==typeof c?'undefined':_typeof(c)){case'function':return c();case'object':return c;}}},{key:'__clickWatching__',value:function __clickWatching__(c){'A'==c.target.tagName&&(c.preventDefault(),this.links.push(c.target.toString()),history.pushState('','',c.target.toString()),this.render())}},{key:'_setMountPlace_',value:function _setMountPlace_(){var c=document.getElementsByTagName('router-view');if(0!=c.length){for(var d=0;d<c.length;d++){this.componentNames.add(c[d].getAttribute('name'));var f=document.createElement('div');f.setAttribute('name','component-'+c[d].getAttribute('name')),c[d].insertAdjacentElement('beforebegin',f)}var g=function(){for(var h=0;h<document.getElementsByTagName('router-view').length;h++)document.getElementsByTagName('router-view')[h].remove();0<document.getElementsByTagName('router-view').length&&g()};g()}}},{key:'_clearMountPlace_',value:function _clearMountPlace_(){this.componentNames.forEach(function(c){document.getElementsByName('component-'+c).forEach(function(d){return d.innerHTML=''})})}},{key:'_runMethods_',value:function _runMethods_(c){for(var j,d=/[^{]+(?=}})/ig,f=c.template,g=c.methods,h=[];null!==(j=d.exec(f));)h=h.concat(j);return null!==h&&h.forEach(function(k){g&&g[k]&&(f=f.replace(RegExp('{{'+k+'}}'),g[k]()))}),f}},{key:'getRouteComponents',value:function getRouteComponents(){var d=this;if(this.routes){var c=this.routes.find(function(f){return f.path==d.getLocation.path});return c?c:this.defaulRoute}}},{key:'addListener',value:function addListener(_ref){var c=_ref.target,d=_ref.type,f=_ref.listener,g=_ref.options,h=_ref.name,j=_ref.once;4>Object.keys(arguments[0]).length||(!('listeners'in this)&&(this.listeners={}),!(d in this.listeners)&&(this.listeners[d]=[]),this.listeners[d].push({target:c,type:d,listener:f,options:g?g:void 0,name:h,once:j||!1}),c.addEventListener(d,f,g?g:void 0))}},{key:'removeListeners',value:function removeListeners(c){var d=this;if(this.listeners){if(Object.keys(this.listeners).forEach(function(g){0==d.listeners[g].length&&delete d.listeners[g]}),0==Object.keys(this.listeners).length)return void delete this.listeners;if(0==arguments.length)return void Object.keys(this.listeners).forEach(function(g){d.listeners[g].forEach(function(h){!0==h.once&&h.target.removeEventListener(h.event,h.listener,h.options)}),d.listeners[g]=d.listeners[g].filter(function(h){return!1==h.once})});if(1==arguments.length){if('string'==typeof c)return void Object.keys(this.listeners).forEach(function(g){d.listeners[g].forEach(function(h){h.name==c&&h.target.removeEventListener(h.type,h.listener,h.options)}),d.listeners[g]=d.listeners[g].filter(function(h){return h.name!==c})});if('object'==('undefined'==typeof c?'undefined':_typeof(c))){Object.keys(c).length;if('name'in c)return void Object.keys(this.listeners).forEach(function(g){d.listeners[g].forEach(function(h){h.name==c.name&&h.target.removeEventListener(h.type,h.listener,h.options)}),d.listeners[g]=d.listeners[g].filter(function(h){return h.name!==c})});if('target'in c&&1==Object.keys(c).length)return void Object.keys(this.listeners).forEach(function(g){d.listeners[g].forEach(function(h){h.target==target&&target.removeEventListener(h.type,h.listener,h.options)}),d.listeners[g]=d.listeners[g].filter(function(h){return h.target!==target})});if('type'in c&&1==Object.keys(c).length&&type in this.listeners)return this.listeners[type].forEach(function(g){return g.target.removeEventListener(type,g.listener,g.options)}),void delete this.listeners[type]}}else return}}},{key:'insertComponent',value:function insertComponent(c){return c?this._runMethods_(this.__typeOfComponent__(c)):void 0}},{key:'render',value:function render(){var f=this;if(this._setMountPlace_(),!!this.getRouteComponents()){this._clearMountPlace_();var c=this.getRouteComponents(),d=function(g){var h=f._runMethods_(f.__typeOfRouteComponents__(c,g));document.getElementsByName('component-'+g).forEach(function(j){return j.insertAdjacentHTML('beforeend',h)})};this.removeListeners(),this.componentNames.forEach(function(g){g in c.components&&Promise.resolve(g).then(function(h){if('beforeMount'in f.__typeOfComponent__(c.components[h])){var j=f.__typeOfComponent__(c.components[h]).beforeMount();j&&'[object Promise]'==j.toString()?j.then(function(){return d(h)}):d(h)}else d(h)}).then(function(){'mounted'in f.__typeOfComponent__(c.components[g])&&f.__typeOfComponent__(c.components[g]).mounted()})})}}},{key:'version',get:function get(){return'0.4.0-beta'}},{key:'getLocation',get:function get(){return{hash:location.hash,href:location.href,origin:location.origin,path:location.pathname,search:location.search}}},{key:'getDefaulRoute',get:function get(){var c;return this.routes&&(c=this.routes.find(function(d){return'*'==d.path})),c}}]),b}();return a.version=a.prototype.version,a.getLocation=a.prototype.getLocation,a.insertComponent=a.prototype.insertComponent,a._runMethods=a.prototype._runMethods_,a.__typeOfComponent=a.prototype.__typeOfComponent__,a}();